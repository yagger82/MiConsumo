<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <link rel="stylesheet" href="styles.css">
    <title>Login</title>

</head>
<body>
<div class="logo-miconsumo text-start ms-4 mt-4">
    <span class="logo-icon"><i class="bi bi-cup-hot-fill"></i></span>
    MiConsumo
</div>
<div class="login-card">
    <h2 class="text-center login-title mb-4"><i class="bi bi-person-circle"></i> Iniciar Sesión</h2>
    <div class="mb-3">
        <!-- <label for="usuario" class="form-label">Usuario</label> -->
        <div class="input-group">
            <span class="input-group-text"><i class="bi bi-person"></i></span>
            <input type="text" maxlength="20" class="form-control" id="usuario" placeholder="Ingrese su usuario" autocomplete="username">
        </div>
    </div>
    <div class="mb-4">
        <!--<label for="password" class="form-label">Contraseña</label> -->
        <div class="input-group">
            <span class="input-group-text"><i class="bi bi-lock"></i></span>
            <input type="password" maxlength="20" class="form-control" id="password" placeholder="Ingrese su contraseña" autocomplete="current-password">
        </div>
    </div>
    <div class="d-flex justify-content-between mb-3">
        <button type="button" class="btn btn-success btn-custom" onclick="login()"><i class="bi bi-box-arrow-in-right"></i> Login</button>
        <button type="button" class="btn btn-secondary btn-custom" onclick="borrarCampos()"><i class="bi bi-eraser"></i> Limpiar</button>
    </div>
    <div class="text-center">
        <pre id="output" class="alert alert-danger d-none"></pre>
    </div>
</div>


<script>
    let token = "";
async function login() {
    const usuario = document.getElementById("usuario").value;
    const password = document.getElementById("password").value;
    // Validación de campos no vacíos
    if (!usuario ) {
            output.textContent = "⚠️ Por favor ingresa usuario.";
            output.classList.remove("d-none");
            output.classList.add("alert", "alert-danger");
            return;
    }

    if (!password) {
            output.textContent = "⚠️ Por favor ingrese contraseña.";
            output.classList.remove("d-none");
            output.classList.add("alert", "alert-danger");
            return;
    }
        output.classList.add("d-none"); // Oculta el mensaje mientras se procesa
    // agregar email y password
    const res = await fetch("http://localhost:3000/api/login", {
        method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ usuario, password })
});
if (res.ok) {
        const data = await res.json();
        token = data.token;
        const userId = data.userId;
        // Guardar token en localStorage
        localStorage.setItem("token", token);
        localStorage.setItem("userId", userId);
        // Redirigir a categorias
        window.location.href = "categorias.html";
    } else {
          const errorText = await res.text();
            output.textContent = "❌ " + (errorText || "Error al iniciar sesión. Verifica tus datos.");
            output.classList.remove("d-none");
            output.classList.add("alert", "alert-danger");
            console.error("Error en login:", errorText);
    }
}
function borrarCampos() {
    document.getElementById("usuario").value = "";
    document.getElementById("password").value = "";
    document.getElementById("output").textContent = "";
}
</script>

</body>
</html>